import * as t from "https://deno.land/std/testing/asserts.ts";
import { QRean } from "./QRean.js";

const imgdata2s = (imgd, step = 1) => {
  const ss = [];
  const width = imgd.width;
  const height = imgd.height;
  const data = imgd.data;
  for (let y = 0; y < height; y += step) {
    for (let x = 0; x < width; x += step) {
      const idx = (x + y * width) * 4;
      if (data[idx]) {
        ss.push("1");
      } else {
        ss.push("0");
      }
    }
    ss.push("\n");
  }
  return ss.join("");
};

Deno.test("mQR", async () => {
  const qrean = await QRean.create();
  const imgd = qrean.make("test", QRean.TYPE_MQR, QRean.DATA_TYPE_AUTO);
  t.assertEquals(imgd.width, 92);
  t.assertEquals(imgd.height, 92);
  //console.log(imgdata2s(imgd, 4));
  t.assertEquals(imgdata2s(imgd, 4), `11111111111111111111111
11111111111111111111111
11111111111111111111111
11111111111111111111111
11110000000101010101111
11110111110111000111111
11110100010100110111111
11110100010101000011111
11110100010101110101111
11110111110100011011111
11110000000111100011111
11111111111100011011111
11110111100100100001111
11111000011101011011111
11110001001011100111111
11111110010010100011111
11110111001110001001111
11111001010110100011111
11110001011000000011111
11111111111111111111111
11111111111111111111111
11111111111111111111111
11111111111111111111111
`);
});
Deno.test("rMQR", async () => {
  const qrean = await QRean.create();
  const imgd = qrean.make("test", QRean.TYPE_RMQR, QRean.DATA_TYPE_AUTO);
  t.assertEquals(imgd.width, 204);
  t.assertEquals(imgd.height, 60);
  //console.log(imgdata2s(imgd, 4));
  t.assertEquals(imgdata2s(imgd, 4), `111111111111111111111111111111111111111111111111111
111111111111111111111111111111111111111111111111111
111111111111111111111111111111111111111111111111111
111111111111111111111111111111111111111111111111111
111100000001010101010101000101010101010101010001111
111101111101101011110111010100001011011001110101111
111101000101010010101100000101101111111000000001111
111101000101100100111100111110100110111111011101111
111101000101110000000111000100010101100011010101111
111101111101000011110110010100011011011001011101111
111100000001010101010101000101010101010101000001111
111111111111111111111111111111111111111111111111111
111111111111111111111111111111111111111111111111111
111111111111111111111111111111111111111111111111111
111111111111111111111111111111111111111111111111111
`);
});
